<%- include('partials/header') -%>

<main class="h-100">
  <div class=" h-100 row m-0">
    <div class=" col-2  d-none d-xl-flex flex-column group-card p-0">
      <div class=" flex-grow-1 py-1">
        <div class="px-3 py-2 d-flex justify-content-between border-bottom">
          <span>GROUP CHATS</span>
          <span class="ms-auto">
            <form class="d-inline-block" id="new-chat" action="/chat/createChat" method="POST" data-user-name="<%= user.userName %>">
              <input hidden type="submit" id="create-chat">
              <label class="nav-link " for="create-chat"><i class="fa-solid fa-plus fa-sm" style="color: #BFD9D7;"></i>
              </label>
            </form>
          </span>
        </div>

        <div class="group-chat-list p-2 pb-0 ">
          <% if (chats.length) { %>
          <ul class="list-unstyled">
            <% for(let i=0; i<chats.length; i++) {%>
            <!--make the this a lil cute box-->
            <div class="p-2">
              <div class="d-flex">
                <a class="link-primary link-underline-opacity-0 w-75" href="/messages/<%= chats[i]._id%>">
                  <li class="card-group-name  mt-3 text-truncate <%= chats[i].groupNameSet ? 'groupNameSet-true' : 'groupNameSet-false' %>" data-chat-id="<%= chats[i]._id %>">
                    <% if (chats[i].groupNameSet) { %>
                    <%= chats[i].groupName %>
                    <% } else { %>
                    <%= chats[i].members.map((member, j) => member.userName).join(', ') %>
                    <% } %>
                  </li>

                </a>
                <a class="ms-auto mt-3" href="/user/<%=user._id%>">
                  <div class=""> <i class=" fa-solid fa-xmark" style="color: #BFD9D7;"></i></div>
                </a>
              </div>


              <div class="member-length fw-normal d-block">
                <%=chats[i].members.length%> Member<%= chats[i].members.length == 1 ? '' : 's' %>
              </div>

            </div>

            <% } %>
          </ul>
          <% } %>
        </div>
      </div>
      <div class="d-flex text-primary p-2  user-card m-0 w-auto">
        <img src="/imgs/gabriel-sample.jpg" alt="User Profile" class="flex-shrink-0 me-2 rounded" width="32" height="32">
        <div class="p-1 mb-0 small lh-sm">
          <strong>@<%=user.userName%></strong>
          <div class="text-light pt-1">
            <%= user.userStatus%>
          </div>

        </div>
        <a class="ms-auto" href="/user/<%=user._id%>">
          <div class="p-2"> <i class="fa-solid fa-gear" style="color: #BFD9D7;"></i></div>
        </a>


      </div>
    </div>


    <div class="col-xl-8 d-flex flex-column p-0 h-100 ">
      <%- include('chat') -%>
    </div>
    <div class="col-2 d-none d-xl-flex flex-column group-card p-0">
      <%- include('members') -%>
    </div>
  </div>
  <div class="offcanvas-xl offcanvas-start group-card" tabindex="-1" id="offcanvasResponsive-groups" aria-labelledby="offcanvasResponsiveLabel">

    
      <div class=" offcanvas-body d-flex flex-column  p-0">
        <div class=" flex-grow-1 py-1">
          <div class="px-3 py-2 d-flex justify-content-between border-bottom">
            <span>GROUP CHATS</span>
            <span class="mx-2">
              <form class="d-inline-block" id="new-chat" action="/chat/createChat" method="POST" data-user-name="<%= user.userName %>">
                <input hidden type="submit" id="create-chat">
                <label class="nav-link " for="create-chat"><i class="fa-solid fa-plus fa-sm" style="color: #BFD9D7;"></i>
                </label>
              </form>
            </span>
            <button type="button" class="btn-close ms-auto" data-bs-dismiss="offcanvas" data-bs-target="#offcanvasResponsive-groups" aria-label="Close"></button>
          </div>


          <div class="group-chat-list p-2 pb-0 ">
            <% if (chats.length) { %>
            <ul class="list-unstyled">
              <% for(let i=0; i<chats.length; i++) {%>
              <!--make the this a lil cute box-->
              <div class="p-2">
                <div class="d-flex">
                  <a class="link-primary link-underline-opacity-0 w-75" href="/messages/<%= chats[i]._id%>">
                    <li class="card-group-name  mt-3 text-truncate <%= chats[i].groupNameSet ? 'groupNameSet-true' : 'groupNameSet-false' %>" data-chat-id="<%= chats[i]._id %>">
                      <% if (chats[i].groupNameSet) { %>
                      <%= chats[i].groupName %>
                      <% } else { %>
                      <%= chats[i].members.map((member, j) => member.userName).join(', ') %>
                      <% } %>
                    </li>

                  </a>
                  <a class="ms-auto mt-3" href="/user/<%=user._id%>">
                    <div class=""> <i class=" fa-solid fa-xmark" style="color: #BFD9D7;"></i></div>
                  </a>
                </div>


                <div class="member-length fw-normal d-block">
                  <%=chats[i].members.length%> Member<%= chats[i].members.length == 1 ? '' : 's' %>
                </div>

              </div>

              <% } %>
            </ul>
            <% } %>
          </div>
        </div>
        <div class="d-flex text-primary p-2  user-card m-0 w-auto">
          <img src="/imgs/gabriel-sample.jpg" alt="User Profile" class="flex-shrink-0 me-2 rounded" width="32" height="32">
          <div class="p-1 mb-0 small lh-sm">
            <strong>@<%=user.userName%></strong>
            <div class="text-light pt-1">
              <%= user.userStatus%>
            </div>
          </div>
          <a class="ms-auto" href="/user/<%=user._id%>">
            <div class="p-2"> <i class="fa-solid fa-gear" style="color: #BFD9D7;"></i></div>
          </a>
        </div>
      </div>
  </div>
  <% if (chat) { %>
  <div class="offcanvas-xl offcanvas-end" tabindex="-1" id="offcanvasResponsive-members" aria-labelledby="offcanvasResponsiveLabel">

    <div class="offcanvas-body">
  
  
      <div class="py-1">
  
        <div class="px-3 py-2 d-flex justify-content-between border-bottom">
          <span class="me-2 ">MEMBERS-<%=group.members.length%></span>
  
          <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#offcanvasResponsive-members" aria-label="Close"></button>
        </div>
  
        <div class="group-chat-list p-2 pb-0 text-primary">
  
          <ul class="list-unstyled ">
            <% for(let i=0; i<group.members.length; i++) {%>
            <!--make the this a lil cute box-->
            <div class="d-flex p-2">
              <li class="mt-3">
                <%= group.members[i].userName%>
              </li>
            </div>
            <% } %>
          </ul>
  
        </div>
      </div>
  
    </div>
  </div>
  <% } %>
</main>

<%- include('partials/footer') -%>